<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ESFJ</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4262871645049971" crossorigin="anonymous"></script>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ESFJ.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ESFJ 운세</h1>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="2065367733"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ESFJ 지수</div>
                <p id="mbtiIndexDisplay">ESFJ 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <div id="giscus-container" style="margin: 15px 0;"></div>
        <script>
            function loadGiscus() {
                const container = document.getElementById('giscus-container');
                while (container.firstChild) container.removeChild(container.firstChild);
                
                const script = document.createElement('script');
                script.src = 'https://giscus.app/client.js';
                script.setAttribute('data-repo', 'OUS-KR/ESFJ.KR');
                script.setAttribute('data-repo-id', 'R_kgDOOrfScQ');
                script.setAttribute('data-category', 'Announcements');
                script.setAttribute('data-category-id', 'DIC_kwDOOrfScc4CqQAN');
                script.setAttribute('data-mapping', 'pathname');
                script.setAttribute('data-strict', '0');
                script.setAttribute('data-reactions-enabled', '1');
                script.setAttribute('data-emit-metadata', '1');
                script.setAttribute('data-input-position', 'top');
                script.setAttribute('data-theme', localStorage.getItem('theme') ?? 'light');
                script.setAttribute('data-loading', 'lazy');
                script.setAttribute('data-lang', 'ko');
                script.setAttribute('crossorigin', 'anonymous');
                script.setAttribute('async', '');
                
                container.appendChild(script);
            }
            
            loadGiscus();
        </script>
        
        <div class="content-card">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="autorelaxed"
                data-ad-client="ca-pub-4262871645049971"
                data-ad-slot="5813041058"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251020100600" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts (ESFJ) ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["당신의 따뜻한 마음씨가", "사람들을 하나로 모으는 능력이", "세심한 관찰력과 배려가", "조화와 안정을 추구하는 성향이", "성실하고 책임감 있는 태도가"],
            verbs: ["주변에 긍정적인 에너지를 전달합니다.", "공동체의 발전에 큰 힘이 될 것입니다.", "상대방에게 큰 감동을 줍니다.", "모두에게 편안하고 안정적인 환경을 제공합니다.", "주변 사람들로부터 깊은 신뢰를 얻게 합니다."],
            connectors: ["그러니", "이 기회를 활용해", "자신감을 갖고", "망설이지 말고"],
            actions: ["주변 사람들에게 먼저 따뜻한 인사를 건네보세요.", "도움이 필요한 동료의 일을 묵묵히 도와주세요.", "가족이나 친구를 위한 작은 이벤트를 계획해 보세요.", "당신이 속한 그룹의 화합을 위한 역할을 찾아보세요.", "자신을 위한 작은 휴식 시간을 갖는 것도 잊지 마세요."]
        },
        task: {
            types: ["챙겨주기:", "계획하기:", "격려하기:", "정리하기:"],
            actions: ["최근 소홀했던", "곧 기념일이 다가오는", "당신의 도움이 필요해 보이는", "어수선하게 느껴지는"],
            subjects: ["주변 사람", "소중한 약속", "동료의 업무", "당신의 공간"],
            verbs: ["에게 안부 연락을 해보세요.", "을(를) 위한 작은 선물을 준비해 보세요.", "를 위해 당신이 할 수 있는 일을 찾아 도와주세요.", "을(를) 깔끔하게 정리하고 새로운 계획을 세워보세요."]
        },
        mbtiIndex: {
            reasons: ["주변 사람들을 향한 따뜻한 배려심이 빛을 발하여", "조화로운 관계 속에서 안정감을 느껴", "책임감과 성실함으로 주변의 신뢰를 얻어", "타인의 행복에서 큰 보람을 느껴"],
            results: ["주변 사람들이 당신 곁에서 편안함을 느낍니다.", "팀의 화합과 협력을 이끌어낼 수 있습니다.", "당신의 노력이 인정받고 긍정적인 평가로 이어집니다.", "인간관계에서 깊은 만족감과 행복을 느낄 수 있습니다."]
        },
        keywords: ["따뜻한", "사교적인", "배려심 깊은", "친절한", "책임감 있는", "성실한", "조화를 추구하는", "외교관", "영사관", "조력자", "현실적인", "구체적인", "인정", "전통", "질서", "계획적", "조직적", "공감", "봉사", "희생"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>